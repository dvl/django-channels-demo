{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Django Channels</title>
</head>
<body>
  <input type="text" id="username" placeholder="Username">
  <input type="text" id="message" placeholder="Message">
  <input type="button" id="send" value="Send">

  <h2>Response</h2>
  <pre id="response"></pre>

  <script>
    // Note that the path doesn't matter for routing; any WebSocket
    // connection gets bumped over to WebSocket consumers
    const socket = new WebSocket("ws://" + window.location.host + "/chat/")

    socket.onmessage = function(e) {
        let el = document.getElementById('response')

        el.innerHTML = el.innerHTML + '\n' + e.data
    }

    function sendMessage() {
      let message = document.getElementById('message'),
          username = document.getElementById('username')

      let msg = {
        'date': Date.now(),
        'username': username.value,
        'text': message.value
      }

      socket.send(JSON.stringify(msg))
    }

    function load() {
      let el = document.getElementById('send')

      el.addEventListener('click', sendMessage, false)
    }

    document.addEventListener('DOMContentLoaded', load, false)

  </script>
</body>
</html>
